// Translations
const translations = {
    pt: {
        // Navigation
        'nav-home': 'Início',
        'nav-about': 'Sobre',
        'nav-services': 'Serviços',
        'nav-process': 'Processo',
        'nav-contact': 'Contato',
        
        // Hero Section
        'hero-title-1': 'Seu imóvel',
        'hero-title-2': 'rende.',
        'hero-subtitle': 'AltaStays cuida de tudo para transformar seu apartamento em renda passiva com aluguel por temporada.',
        'benefit-1': 'Liberdade',
        'benefit-2': 'Lucro',
        'benefit-3': 'Tranquilidade',
        'cta-main': 'Descobrir quanto posso ganhar',
        'cta-whatsapp': 'WhatsApp',
        'floating-card-1': 'Seu apartamento',
        'floating-card-2': 'Renda passiva',
        
        // About Section
        'about-title': 'Nossa História',
        'about-p1': 'Há 7 anos, descobrimos a magia de receber pessoas em nosso apartamento no Airbnb. Foi incrível fazer parte da comunidade Airbnb e ver como cada hóspede trazia histórias únicas para nosso espaço.',
        'about-p2': 'Após anos de experiência e conquistas como Superhost, decidimos expandir e ajudar outros proprietários a transformar seus imóveis em fontes de renda passiva através do aluguel por temporada.',
        'about-p3': 'Hoje, a AltaStays gerencia propriedades em São Paulo e região, oferecendo serviço completo para que você tenha tranquilidade e lucro garantido.',
        'founder-title': 'Fundadora & Superhost Airbnb',
        'superhost': 'Superhost',
        'stat-years': 'Anos de experiência',
        'stat-superhost': 'Status Superhost',
        'stat-guests': 'Hóspedes felizes',
        
        // Services Section
        'services-title': 'Tu mieszkanie zarabia, Eu zajmujemy się resztą',
        'services-subtitle': 'Cuidamos de cada detalhe para maximizar sua renda',
        'service-marketing': 'Marketing',
        'service-marketing-desc': 'Criamos anúncios otimizados nas principais plataformas para máxima visibilidade',
        'service-photography': 'Fotografia',
        'service-photography-desc': 'Fotos profissionais que destacam o melhor do seu imóvel',
        'service-guest': 'Atendimento aos Hóspedes',
        'service-guest-desc': 'Suporte 24/7 para garantir a melhor experiência dos seus hóspedes',
        'service-linens': 'Roupa de Cama e Toalhas',
        'service-linens-desc': 'Fornecemos e cuidamos de toda roupa de cama e banho premium',
        'service-cleaning': 'Limpeza e Manutenção',
        'service-cleaning-desc': 'Limpeza profissional e manutenção preventiva do seu imóvel',
        'service-pricing': 'Gerenciamento de Preços',
        'service-pricing-desc': 'Otimização dinâmica de preços para máxima rentabilidade',
        'service-staging': 'Home Staging',
        'service-staging-desc': 'Design de interiores profissional para atrair mais hóspedes',
        'service-insurance': 'Garantia de Danos',
        'service-insurance-desc': 'Cobertura completa contra danos para sua tranquilidade',
        
        // Before/After Section
        'ba-title': 'Mais Lucro, Menor Preocupação',
        'ba-subtitle': 'Veja a transformação que fazemos nos seus resultados',
        'ba-before': 'Antes',
        'ba-after': 'Depois',
        'ba-before-img': 'Imóvel básico',
        'ba-after-img': 'Imóvel profissional',
        'ba-revenue': 'Receita mensal:',
        'ba-occupancy': 'Taxa de ocupação:',
        'ba-rating': 'Avaliação:',
        'testimonial-text': '"Este foi um dos melhores anfitriões do Airbnb em que já me hospedei! O apartamento era lindo, confortável e muito limpo. A comunicação foi excelente!"',
        
        // Process Section
        'process-title': 'Como Funciona',
        'process-subtitle': 'Processo simples em 3 etapas para começar a lucrar',
        'step1-title': 'Contato e Avaliação',
        'step1-desc': 'Entre em contato conosco e faremos uma avaliação gratuita do potencial de rentabilidade do seu imóvel',
        'step2-title': 'Contrato e Preparação',
        'step2-desc': 'Assinamos o contrato e assumimos o controle total: fotos profissionais, anúncios e home staging',
        'step3-title': 'Renda Passiva',
        'step3-desc': 'Seu imóvel começa a gerar renda imediatamente. Você recebe mensalmente sem se preocupar com nada',
        'calc-title': 'Calcule seu potencial de ganho',
        'calc-bedrooms': 'Quartos:',
        'calc-location': 'Região:',
        'calc-button': 'Calcular',
        'calc-result-text': 'Seu imóvel pode gerar aproximadamente',
        'calc-result-month': 'por mês',
        
        // Contact Section
        'contact-title': 'Pronto para começar?',
        'contact-subtitle': 'Entre em contato e descubra quanto seu imóvel pode render',
        'contact-phone': 'Telefone',
        'contact-location': 'Localização',
        'form-name': 'Nome completo',
        'form-email': 'Email',
        'form-phone': 'Telefone',
        'form-property-select': 'Selecione o tipo de imóvel',
        'form-apartment': 'Apartamento',
        'form-house': 'Casa',
        'form-studio': 'Studio',
        'form-penthouse': 'Cobertura',
        'form-property-type': 'Tipo de imóvel',
        'form-message': 'Mensagem (opcional)',
        'form-submit': 'Quero saber mais',
        'form-success': 'Mensagem enviada com sucesso! Entraremos em contato em breve.',
        'form-error': 'Erro ao enviar mensagem. Tente novamente.',
        
        // Footer
        'footer-desc': 'Transformando imóveis em renda passiva através do aluguel por temporada.',
        'footer-services': 'Serviços',
        'footer-management': 'Gestão completa',
        'footer-photography': 'Fotografia profissional',
        'footer-cleaning': 'Limpeza',
        'footer-staging': 'Home staging',
        'footer-company': 'Empresa',
        'footer-about': 'Sobre nós',
        'footer-process': 'Como funciona',
        'footer-contact': 'Contato',
        'footer-social': 'Redes Sociais',
        'footer-rights': 'Todos os direitos reservados.'
    },
    en: {
        // Navigation
        'nav-home': 'Home',
        'nav-about': 'About',
        'nav-services': 'Services',
        'nav-process': 'Process',
        'nav-contact': 'Contact',
        
        // Hero Section
        'hero-title-1': 'Your property',
        'hero-title-2': 'earns.',
        'hero-subtitle': 'AltaStays takes care of everything to transform your apartment into passive income through short-term rentals.',
        'benefit-1': 'Freedom',
        'benefit-2': 'Profit',
        'benefit-3': 'Peace of mind',
        'cta-main': 'Discover how much I can earn',
        'cta-whatsapp': 'WhatsApp',
        'floating-card-1': 'Your apartment',
        'floating-card-2': 'Passive income',
        
        // About Section
        'about-title': 'Our Story',
        'about-p1': '7 years ago, we discovered the magic of hosting people in our Airbnb apartment. It was amazing to be part of the Airbnb community and see how each guest brought unique stories to our space.',
        'about-p2': 'After years of experience and achievements as Superhost, we decided to expand and help other property owners transform their properties into passive income sources through short-term rentals.',
        'about-p3': 'Today, AltaStays manages properties in São Paulo and surroundings, offering complete service so you have peace of mind and guaranteed profit.',
        'founder-title': 'Founder & Airbnb Superhost',
        'superhost': 'Superhost',
        'stat-years': 'Years of experience',
        'stat-superhost': 'Superhost Status',
        'stat-guests': 'Happy guests',
        
        // Services Section
        'services-title': 'Your apartment earns, We take care of the rest',
        'services-subtitle': 'We take care of every detail to maximize your income',
        'service-marketing': 'Marketing',
        'service-marketing-desc': 'We create optimized listings on major platforms for maximum visibility',
        'service-photography': 'Photography',
        'service-photography-desc': 'Professional photos that highlight the best of your property',
        'service-guest': 'Guest Service',
        'service-guest-desc': '24/7 support to ensure the best experience for your guests',
        'service-linens': 'Bed Linens and Towels',
        'service-linens-desc': 'We provide and care for all premium bed and bath linens',
        'service-cleaning': 'Cleaning and Maintenance',
        'service-cleaning-desc': 'Professional cleaning and preventive maintenance of your property',
        'service-pricing': 'Price Management',
        'service-pricing-desc': 'Dynamic price optimization for maximum profitability',
        'service-staging': 'Home Staging',
        'service-staging-desc': 'Professional interior design to attract more guests',
        'service-insurance': 'Damage Coverage',
        'service-insurance-desc': 'Complete coverage against damages for your peace of mind',
        
        // Before/After Section
        'ba-title': 'More Profit, Less Worry',
        'ba-subtitle': 'See the transformation we make in your results',
        'ba-before': 'Before',
        'ba-after': 'After',
        'ba-before-img': 'Basic property',
        'ba-after-img': 'Professional property',
        'ba-revenue': 'Monthly revenue:',
        'ba-occupancy': 'Occupancy rate:',
        'ba-rating': 'Rating:',
        'testimonial-text': '"This was one of the best Airbnb hosts I\'ve ever stayed with! The apartment was beautiful, comfortable and very clean. Communication was excellent!"',
        
        // Process Section
        'process-title': 'How It Works',
        'process-subtitle': 'Simple 3-step process to start earning',
        'step1-title': 'Contact and Assessment',
        'step1-desc': 'Contact us and we\'ll do a free assessment of your property\'s profitability potential',
        'step2-title': 'Contract and Preparation',
        'step2-desc': 'We sign the contract and take full control: professional photos, listings and home staging',
        'step3-title': 'Passive Income',
        'step3-desc': 'Your property starts generating income immediately. You receive monthly without worrying about anything',
        'calc-title': 'Calculate your earning potential',
        'calc-bedrooms': 'Bedrooms:',
        'calc-location': 'Region:',
        'calc-button': 'Calculate',
        'calc-result-text': 'Your property can generate approximately',
        'calc-result-month': 'per month',
        
        // Contact Section
        'contact-title': 'Ready to start?',
        'contact-subtitle': 'Get in touch and discover how much your property can earn',
        'contact-phone': 'Phone',
        'contact-location': 'Location',
        'form-name': 'Full name',
        'form-email': 'Email',
        'form-phone': 'Phone',
        'form-property-select': 'Select property type',
        'form-apartment': 'Apartment',
        'form-house': 'House',
        'form-studio': 'Studio',
        'form-penthouse': 'Penthouse',
        'form-property-type': 'Property type',
        'form-message': 'Message (optional)',
        'form-submit': 'I want to know more',
        'form-success': 'Message sent successfully! We will contact you soon.',
        'form-error': 'Error sending message. Please try again.',
        
        // Footer
        'footer-desc': 'Transforming properties into passive income through short-term rentals.',
        'footer-services': 'Services',
        'footer-management': 'Complete management',
        'footer-photography': 'Professional photography',
        'footer-cleaning': 'Cleaning',
        'footer-staging': 'Home staging',
        'footer-company': 'Company',
        'footer-about': 'About us',
        'footer-process': 'How it works',
        'footer-contact': 'Contact',
        'footer-social': 'Social Media',
        'footer-rights': 'All rights reserved.'
    }
};

// Current language
let currentLang = 'pt';

// DOM Elements
const navToggle = document.querySelector('.nav-toggle');
const navMenu = document.querySelector('.nav-menu');
const navbar = document.querySelector('.navbar');
const langButtons = document.querySelectorAll('.lang-btn');
const contactForm = document.getElementById('contactForm');

// Initialize the website
document.addEventListener('DOMContentLoaded', function() {
    initializeNavigation();
    initializeScrollEffects();
    initializeLanguageToggle();
    initializeContactForm();
    initializeAnimations();
    updateTranslations();
    
    // Set initial language based on browser or default to Portuguese
    const browserLang = navigator.language.toLowerCase();
    if (browserLang.startsWith('en')) {
        setLanguage('en');
    }
});

// Navigation functionality
function initializeNavigation() {
    // Mobile menu toggle
    navToggle.addEventListener('click', function() {
        navMenu.classList.toggle('active');
        navToggle.classList.toggle('active');
    });

    // Close menu when clicking on links
    document.querySelectorAll('.nav-menu a[href^="#"]').forEach(link => {
        link.addEventListener('click', function() {
            navMenu.classList.remove('active');
            navToggle.classList.remove('active');
        });
    });

    // Close menu when clicking outside
    document.addEventListener('click', function(e) {
        if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
            navMenu.classList.remove('active');
            navToggle.classList.remove('active');
        }
    });

    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                const offsetTop = target.offsetTop - 70; // Account for fixed navbar
                window.scrollTo({
                    top: offsetTop,
                    behavior: 'smooth'
                });
            }
        });
    });
}

// Scroll effects
function initializeScrollEffects() {
    window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset;
        
        // Navbar background on scroll
        if (scrollTop > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
        
        // Parallax effect for hero background elements
        const bgCircle1 = document.querySelector('.bg-circle-1');
        const bgCircle2 = document.querySelector('.bg-circle-2');
        
        if (bgCircle1 && bgCircle2) {
            bgCircle1.style.transform = `translateY(${scrollTop * 0.1}px)`;
            bgCircle2.style.transform = `translateY(${scrollTop * 0.15}px)`;
        }
        
        // Animate elements on scroll
        animateOnScroll();
    });
}

// Animate elements when they come into view
function animateOnScroll() {
    const elements = document.querySelectorAll('.service-card, .stat-card, .step, .comparison-card');
    
    elements.forEach(element => {
        const elementTop = element.getBoundingClientRect().top;
        const elementVisible = 150;
        
        if (elementTop < window.innerHeight - elementVisible) {
            element.classList.add('fade-in-up');
        }
    });
}

// Language toggle functionality
function initializeLanguageToggle() {
    langButtons.forEach(button => {
        button.addEventListener('click', function() {
            const lang = this.getAttribute('data-lang');
            setLanguage(lang);
        });
    });
}

function setLanguage(lang) {
    currentLang = lang;
    
    // Update active language button
    langButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        }
    });
    
    // Update document language
    document.documentElement.lang = lang === 'pt' ? 'pt-BR' : 'en';
    
    // Update all translations
    updateTranslations();
}

function updateTranslations() {
    const elements = document.querySelectorAll('[data-translate]');
    
    elements.forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[currentLang] && translations[currentLang][key]) {
            element.textContent = translations[currentLang][key];
        }
    });
    
    // Update placeholders
    const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
    placeholderElements.forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        if (translations[currentLang] && translations[currentLang][key]) {
            element.placeholder = translations[currentLang][key];
        }
    });
}

// Contact form functionality
function initializeContactForm() {
    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            handleFormSubmit(this);
        });
    }
}

function handleFormSubmit(form) {
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    
    // Basic validation
    if (!data.name || !data.email || !data.phone) {
        showMessage(translations[currentLang]['form-error'] || 'Please fill in all required fields.', 'error');
        return;
    }
    
    // Email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(data.email)) {
        showMessage('Please enter a valid email address.', 'error');
        return;
    }
    
    // Simulate form submission (replace with actual endpoint)
    simulateFormSubmission(data)
        .then(() => {
            showMessage(translations[currentLang]['form-success'] || 'Message sent successfully!', 'success');
            form.reset();
        })
        .catch(() => {
            showMessage(translations[currentLang]['form-error'] || 'Error sending message. Please try again.', 'error');
        });
}

function simulateFormSubmission(data) {
    return new Promise((resolve, reject) => {
        // Simulate API call delay
        setTimeout(() => {
            // Log form data (in production, send to your backend)
            console.log('Form submitted:', data);
            
            // Create WhatsApp message
            const message = createWhatsAppMessage(data);
            
            // Simulate success (90% success rate)
            if (Math.random() > 0.1) {
                resolve(data);
            } else {
                reject(new Error('Submission failed'));
            }
        }, 1500);
    });
}

function createWhatsAppMessage(data) {
    const messages = {
        pt: `Olá! Tenho interesse em transformar meu imóvel em renda passiva.

*Dados do contato:*
Nome: ${data.name}
Email: ${data.email}
Telefone: ${data.phone}
Tipo de imóvel: ${data['property-type'] || 'Não informado'}

${data.message ? `Mensagem: ${data.message}` : ''}

Aguardo contato para mais informações.`,
        
        en: `Hello! I'm interested in transforming my property into passive income.

*Contact details:*
Name: ${data.name}
Email: ${data.email}
Phone: ${data.phone}
Property type: ${data['property-type'] || 'Not specified'}

${data.message ? `Message: ${data.message}` : ''}

Looking forward to hearing from you.`
    };
    
    const message = encodeURIComponent(messages[currentLang]);
    const whatsappUrl = `https://wa.me/5511987654321?text=${message}`;
    
    // Open WhatsApp after a short delay
    setTimeout(() => {
        window.open(whatsappUrl, '_blank');
    }, 2000);
}

function showMessage(text, type) {
    // Remove existing messages
    const existingMessage = document.querySelector('.form-message');
    if (existingMessage) {
        existingMessage.remove();
    }
    
    // Create message element
    const message = document.createElement('div');
    message.className = `form-message ${type}`;
    message.textContent = text;
    message.style.cssText = `
        padding: 1rem;
        margin-top: 1rem;
        border-radius: 8px;
        font-weight: 600;
        text-align: center;
        animation: fadeInUp 0.3s ease-out;
        ${type === 'success' ? 
            'background: #D1FAE5; color: #065F46; border: 1px solid #A7F3D0;' : 
            'background: #FEE2E2; color: #991B1B; border: 1px solid #FECACA;'
        }
    `;
    
    // Insert message after form
    contactForm.appendChild(message);
    
    // Remove message after 5 seconds
    setTimeout(() => {
        if (message.parentNode) {
            message.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => message.remove(), 300);
        }
    }, 5000);
}

// Revenue calculator
function calculateRevenue() {
    const bedrooms = document.getElementById('bedrooms').value;
    const location = document.getElementById('location').value;
    const resultDiv = document.getElementById('calc-result');
    
    if (!bedrooms || !location) {
        resultDiv.innerHTML = '<p style="color: #EF4444;">Por favor, selecione todas as opções.</p>';
        return;
    }
    
    // Base prices by bedrooms (in BRL)
    const basePrices = {
        '1': 2500,
        '2': 3500,
        '3': 4500,
        '4': 6000
    };
    
    // Location multipliers
    const locationMultipliers = {
        'centro': 0.8,
        'vila-madalena': 1.2,
        'itaim': 1.4,
        'jardins': 1.3,
        'moema': 1.1,
        'outros': 1.0
    };
    
    const basePrice = basePrices[bedrooms] || 3000;
    const multiplier = locationMultipliers[location] || 1.0;
    const estimatedRevenue = Math.round(basePrice * multiplier);
    
    const resultText = currentLang === 'pt' ? 
        `Seu imóvel pode gerar aproximadamente <strong>R$ ${estimatedRevenue.toLocaleString('pt-BR')}</strong> por mês` :
        `Your property can generate approximately <strong>R$ ${estimatedRevenue.toLocaleString('en-US')}</strong> per month`;
    
    resultDiv.innerHTML = `
        <div style="background: linear-gradient(135deg, #2D6A4F, #52B788); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
            <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">${resultText}</div>
            <div style="font-size: 0.9rem; opacity: 0.9;">
                ${currentLang === 'pt' ? 
                    '*Estimativa baseada em dados de mercado de São Paulo' : 
                    '*Estimate based on São Paulo market data'}
            </div>
        </div>
    `;
    
    // Add success animation
    resultDiv.style.animation = 'fadeInUp 0.5s ease-out';
    
    // Scroll to result
    setTimeout(() => {
        resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }, 300);
}

// Initialize animations
function initializeAnimations() {
    // Intersection Observer for scroll animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in-up');
                
                // Add staggered animation for grids
                if (entry.target.classList.contains('services-grid')) {
                    const cards = entry.target.querySelectorAll('.service-card');
                    cards.forEach((card, index) => {
                        setTimeout(() => {
                            card.classList.add('fade-in-up');
                        }, index * 100);
                    });
                }
                
                if (entry.target.classList.contains('process-steps')) {
                    const steps = entry.target.querySelectorAll('.step');
                    steps.forEach((step, index) => {
                        setTimeout(() => {
                            step.classList.add('fade-in-up');
                        }, index * 200);
                    });
                }
            }
        });
    }, observerOptions);
    
    // Observe elements for animation
    const elementsToAnimate = document.querySelectorAll(`
        .about-content,
        .services-grid,
        .comparison-container,
        .process-steps,
        .revenue-calculator,
        .contact-content,
        .service-card,
        .stat-card,
        .step,
        .comparison-card
    `);
    
    elementsToAnimate.forEach(el => observer.observe(el));
}

// Utility functions
function debounce(func, wait, immediate) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            timeout = null;
            if (!immediate) func(...args);
        };
        const callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func(...args);
    };
}

function throttle(func, limit) {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

// Optimized scroll handler
const optimizedScrollHandler = throttle(function() {
    const scrollTop = window.pageYOffset;
    
    // Navbar background
    if (scrollTop > 50) {
        navbar.classList.add('scrolled');
    } else {
        navbar.classList.remove('scrolled');
    }
    
    // Parallax effects
    const bgElements = document.querySelectorAll('.bg-circle-1, .bg-circle-2');
    bgElements.forEach((element, index) => {
        const speed = (index + 1) * 0.1;
        element.style.transform = `translateY(${scrollTop * speed}px)`;
    });
}, 16); // ~60fps

// Replace the scroll event listener
window.removeEventListener('scroll', initializeScrollEffects);
window.addEventListener('scroll', optimizedScrollHandler);

// Form validation helpers
function validateEmail(email) {
    const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(String(email).toLowerCase());
}

function validatePhone(phone) {
    const re = /^[\+]?[1-9][\d]{0,15}$/;
    return re.test(phone.replace(/\s/g, ''));
}

// Enhanced form validation
function validateForm(formData) {
    const errors = [];
    
    if (!formData.name || formData.name.trim().length < 2) {
        errors.push(currentLang === 'pt' ? 'Nome deve ter pelo menos 2 caracteres' : 'Name must be at least 2 characters');
    }
    
    if (!formData.email || !validateEmail(formData.email)) {
        errors.push(currentLang === 'pt' ? 'Email inválido' : 'Invalid email address');
    }
    
    if (!formData.phone || !validatePhone(formData.phone)) {
        errors.push(currentLang === 'pt' ? 'Telefone inválido' : 'Invalid phone number');
    }
    
    if (!formData['property-type']) {
        errors.push(currentLang === 'pt' ? 'Selecione o tipo de imóvel' : 'Please select property type');
    }
    
    return errors;
}

// Update form submission handler
function handleFormSubmit(form) {
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    
    // Validate form
    const errors = validateForm(data);
    
    if (errors.length > 0) {
        showMessage(errors[0], 'error');
        return;
    }
    
    // Show loading state
    const submitButton = form.querySelector('button[type="submit"]');
    const originalText = submitButton.textContent;
    submitButton.textContent = currentLang === 'pt' ? 'Enviando...' : 'Sending...';
    submitButton.disabled = true;
    
    // Simulate form submission
    simulateFormSubmission(data)
        .then(() => {
            showMessage(translations[currentLang]['form-success'], 'success');
            form.reset();
        })
        .catch(() => {
            showMessage(translations[currentLang]['form-error'], 'error');
        })
        .finally(() => {
            submitButton.textContent = originalText;
            submitButton.disabled = false;
        });
}

// Performance optimizations
function optimizeImages() {
    const images = document.querySelectorAll('img');
    
    if ('loading' in HTMLImageElement.prototype) {
        images.forEach(img => {
            img.loading = 'lazy';
        });
    } else {
        // Fallback for browsers that don't support lazy loading
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.classList.remove('lazy');
                    imageObserver.unobserve(img);
                }
            });
        });
        
        images.forEach(img => imageObserver.observe(img));
    }
}

// Accessibility improvements
function enhanceAccessibility() {
    // Add focus indicators
    const focusableElements = document.querySelectorAll('a, button, input, select, textarea');
    focusableElements.forEach(element => {
        element.addEventListener('focus', function() {
            this.style.outline = '2px solid #F59E0B';
            this.style.outlineOffset = '2px';
        });
        
        element.addEventListener('blur', function() {
            this.style.outline = '';
            this.style.outlineOffset = '';
        });
    });
    
    // Keyboard navigation for mobile menu
    navToggle.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.click();
        }
    });
    
    // Skip to main content link
    const skipLink = document.createElement('a');
    skipLink.href = '#inicio';
    skipLink.textContent = currentLang === 'pt' ? 'Pular para conteúdo principal' : 'Skip to main content';
    skipLink.className = 'sr-only';
    skipLink.style.cssText = `
        position: absolute;
        top: -40px;
        left: 6px;
        background: #2D6A4F;
        color: white;
        padding: 8px;
        text-decoration: none;
        border-radius: 4px;
        z-index: 1000;
        transition: top 0.3s;
    `;
    
    skipLink.addEventListener('focus', function() {
        this.style.top = '6px';
    });
    
    skipLink.addEventListener('blur', function() {
        this.style.top = '-40px';
    });
    
    document.body.insertBefore(skipLink, document.body.firstChild);
}

// Initialize performance optimizations
document.addEventListener('DOMContentLoaded', function() {
    optimizeImages();
    enhanceAccessibility();
});

// Error handling
window.addEventListener('error', function(e) {
    console.error('JavaScript error:', e.error);
    // In production, you might want to send this to an error tracking service
});

// Service worker registration for PWA capabilities (optional)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
                console.log('ServiceWorker registration successful');
            })
            .catch(function(err) {
                console.log('ServiceWorker registration failed');
            });
    });
}

// Analytics and tracking (placeholder)
function trackEvent(eventName, properties = {}) {
    // Replace with your analytics service (Google Analytics, Mixpanel, etc.)
    console.log('Event tracked:', eventName, properties);
    
    // Example for Google Analytics
    if (typeof gtag !== 'undefined') {
        gtag('event', eventName, properties);
    }
}

// Track important interactions
document.addEventListener('DOMContentLoaded', function() {
    // Track CTA clicks
    document.querySelectorAll('.btn-primary, .btn-whatsapp').forEach(button => {
        button.addEventListener('click', function() {
            const buttonText = this.textContent.trim();
            trackEvent('cta_click', {
                button_text: buttonText,
                page_section: this.closest('section')?.id || 'unknown'
            });
        });
    });
    
    // Track form submissions
    if (contactForm) {
        contactForm.addEventListener('submit', function() {
            trackEvent('form_submit', {
                form_id: 'contact_form'
            });
        });
    }
    
    // Track language changes
    langButtons.forEach(button => {
        button.addEventListener('click', function() {
            trackEvent('language_change', {
                from_language: currentLang,
                to_language: this.getAttribute('data-lang')
            });
        });
    });
    
    // Track calculator usage
    const calcButton = document.querySelector('.calc-btn');
    if (calcButton) {
        calcButton.addEventListener('click', function() {
            const bedrooms = document.getElementById('bedrooms').value;
            const location = document.getElementById('location').value;
            trackEvent('calculator_use', {
                bedrooms: bedrooms,
                location: location
            });
        });
    }
});

// Scroll to top functionality
function createScrollToTop() {
    const scrollButton = document.createElement('button');
    scrollButton.innerHTML = '<i class="fas fa-arrow-up"></i>';
    scrollButton.className = 'scroll-to-top';
    scrollButton.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: #2D6A4F;
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 1000;
    `;
    
    scrollButton.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
        trackEvent('scroll_to_top');
    });
    
    document.body.appendChild(scrollButton);
    
    // Show/hide based on scroll position
    window.addEventListener('scroll', throttle(function() {
        if (window.pageYOffset > 300) {
            scrollButton.style.opacity = '1';
            scrollButton.style.visibility = 'visible';
        } else {
            scrollButton.style.opacity = '0';
            scrollButton.style.visibility = 'hidden';
        }
    }, 100));
}

// Initialize scroll to top button
document.addEventListener('DOMContentLoaded', createScrollToTop);

// Preload critical resources
function preloadCriticalResources() {
    const criticalResources = [
        'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap',
        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css'
    ];
    
    criticalResources.forEach(url => {
        const link = document.createElement('link');
        link.rel = 'preload';
        link.as = 'style';
        link.href = url;
        document.head.appendChild(link);
    });
}

// Initialize preloading
preloadCriticalResources();

// Export functions for global access
window.AltaStays = {
    setLanguage,
    calculateRevenue,
    trackEvent
};